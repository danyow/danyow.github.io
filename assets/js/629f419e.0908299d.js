"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[66275],{35318:function(e,r,t){t.d(r,{Zo:function(){return u},kt:function(){return p}});var o=t(27378);function a(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function l(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(Object(t),!0).forEach((function(r){a(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function i(e,r){if(null==e)return{};var t,o,a=function(e,r){if(null==e)return{};var t,o,a={},n=Object.keys(e);for(o=0;o<n.length;o++)t=n[o],r.indexOf(t)>=0||(a[t]=e[t]);return a}(e,r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(o=0;o<n.length;o++)t=n[o],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=o.createContext({}),s=function(e){var r=o.useContext(c),t=r;return e&&(t="function"==typeof e?e(r):l(l({},r),e)),t},u=function(e){var r=s(e.components);return o.createElement(c.Provider,{value:r},e.children)},g={inlineCode:"code",wrapper:function(e){var r=e.children;return o.createElement(o.Fragment,{},r)}},m=o.forwardRef((function(e,r){var t=e.components,a=e.mdxType,n=e.originalType,c=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),m=s(t),p=a,b=m["".concat(c,".").concat(p)]||m[p]||g[p]||n;return t?o.createElement(b,l(l({ref:r},u),{},{components:t})):o.createElement(b,l({ref:r},u))}));function p(e,r){var t=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var n=t.length,l=new Array(n);l[0]=m;var i={};for(var c in r)hasOwnProperty.call(r,c)&&(i[c]=r[c]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var s=2;s<n;s++)l[s]=t[s];return o.createElement.apply(null,l)}return o.createElement.apply(null,t)}m.displayName="MDXCreateElement"},62176:function(e,r,t){t.r(r),t.d(r,{assets:function(){return s},contentTitle:function(){return i},default:function(){return m},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return u}});t(27378);var o=t(35318);function a(){return a=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},a.apply(this,arguments)}function n(e,r){if(null==e)return{};var t,o,a=function(e,r){if(null==e)return{};var t,o,a={},n=Object.keys(e);for(o=0;o<n.length;o++)t=n[o],r.indexOf(t)>=0||(a[t]=e[t]);return a}(e,r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(o=0;o<n.length;o++)t=n[o],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}const l={id:"Disabling garbage collection",slug:"/unity-overview/analysis/performance-memory-overview/performance-garbage-collector/performance-disabling-garbage-collection"},i="Disabling garbage collection",c={unversionedId:"unity/unity-overview/analysis/performance-memory-overview/performance-garbage-collector/Disabling garbage collection",id:"version-Unity@2022.1/unity/unity-overview/analysis/performance-memory-overview/performance-garbage-collector/Disabling garbage collection",title:"Disabling garbage collection",description:"You can use the GarbageCollector.GCMode to disable garbage collection at run time. This prevents CPU spikes, but the memory usage of your application never decreases, because the garbage collector doesn\u2019t collect objects that no longer have any references.",source:"@site/versioned_docs/version-Unity@2022.1/unity/unity-overview/analysis/performance-memory-overview/performance-garbage-collector/performance-disabling-garbage-collection.md",sourceDirName:"unity/unity-overview/analysis/performance-memory-overview/performance-garbage-collector",slug:"/unity-overview/analysis/performance-memory-overview/performance-garbage-collector/performance-disabling-garbage-collection",permalink:"/docs/unity-overview/analysis/performance-memory-overview/performance-garbage-collector/performance-disabling-garbage-collection",editUrl:"https://crowdin.com/project/docusaurus-v2/zh-Hans",tags:[],version:"Unity@2022.1",lastUpdatedBy:"danyow",lastUpdatedAt:1648742180,formattedLastUpdatedAt:"2022/3/31",frontMatter:{id:"Disabling garbage collection",slug:"/unity-overview/analysis/performance-memory-overview/performance-garbage-collector/performance-disabling-garbage-collection"},sidebar:"unity",previous:{title:"Garbage collector overview",permalink:"/docs/unity-overview/analysis/performance-memory-overview/performance-garbage-collector/performance-garbage-collector"},next:{title:"Garbage collection best practices",permalink:"/docs/unity-overview/analysis/performance-memory-overview/performance-garbage-collector/performance-garbage-collection-best-practices"}},s={},u=[],g={toc:u};function m(e){var{components:r}=e,t=n(e,["components"]);return(0,o.kt)("wrapper",a({},g,t,{components:r,mdxType:"MDXLayout"}),(0,o.kt)("h1",a({},{id:"disabling-garbage-collection"}),"Disabling garbage collection"),(0,o.kt)("p",null,"You can use the ",(0,o.kt)("a",a({parentName:"p"},{href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/Scripting.GarbageCollector.GCMode.html"}),"GarbageCollector.GCMode")," to disable garbage collection at run time. This prevents CPU spikes, but the memory usage of your application never decreases, because the garbage collector doesn\u2019t collect objects that no longer have any references."),(0,o.kt)("p",null," ",(0,o.kt)("strong",{parentName:"p"},"Warning:"),"  Disabling the garbage collector requires careful memory management. If you don\u2019t manage memory carefully, the managed heap continuously expands until your application runs out of memory, and the operating system shuts it down."),(0,o.kt)("p",null,"You can use the following APIs to fine-tune control over the automatic garbage collector:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"System.GC.Collect"),": Performs a full, blocking garbage collection."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",a({parentName:"li"},{href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/Scripting.GarbageCollector.Mode.Disabled.html"}),"GarbageCollector.Mode.Disabled"),": Fully disables the garbage collector. Using ",(0,o.kt)("inlineCode",{parentName:"li"},"System.Gc.Collect")," in this mode has no effect."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",a({parentName:"li"},{href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/Scripting.GarbageCollector.Mode.Manual.html"}),"GarbageCollector.Mode.Manual"),": Disables automatic invocations of the garbage collector, but you can still use ",(0,o.kt)("inlineCode",{parentName:"li"},"System.GC.Collect")," to run a full collection."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"GarbageCollection.CollectIncremental"),": Runs the garbage collector ",(0,o.kt)("a",a({parentName:"li"},{href:"/docs/unity-overview/analysis/performance-memory-overview/performance-garbage-collector/performance-incremental-garbage-collection"}),"incrementally"),".")),(0,o.kt)("p",null,"You should only disable garbage collection during short, performance-critical parts of your application, when you are able to calculate and control how much memory you need to allocate. You should immediately enable the garbage collector afterward, and profile your project often to ensure that you don\u2019t trigger additional managed allocation which might cause the managed heap to get too big."),(0,o.kt)("p",null,"When you disable the garbage collector, it doesn\u2019t stop your application to perform a garbage collection. Calling ",(0,o.kt)("inlineCode",{parentName:"p"},"System.GC.Collect")," has no effect and doesn\u2019t start a collection. To avoid increased memory usage over time, you must take care when managing memory. Ideally, you should allocate all memory before you disable the garbage collector and avoid additional allocations while it is disabled."),(0,o.kt)("p",null,"It\u2019s best practice to only disable the garbage collector for long-lived allocations. For example, you might want to allocate all required memory for a level of your game before it loads, and then disable the garbage collector to avoid performance overhead during the level. After the level is completed and all memory is released, you can then enable the garbage collector again and use ",(0,o.kt)("inlineCode",{parentName:"p"},"System.GC.Collect")," to reclaim memory before loading the next level."),(0,o.kt)("p",null,"For more details on how to enable and disable garbage collection at run time, see the ",(0,o.kt)("a",a({parentName:"p"},{href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/Scripting.GarbageCollector.html"}),"GarbageCollector")," Scripting API page."))}m.isMDXComponent=!0}}]);