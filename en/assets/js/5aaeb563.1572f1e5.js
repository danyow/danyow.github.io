"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[15239],{35318:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return f}});var r=n(27378);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=r.createContext({}),s=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=s(e.components);return r.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=s(n),f=i,m=u["".concat(p,".").concat(f)]||u[f]||c[f]||a;return n?r.createElement(m,o(o({ref:t},d),{},{components:n})):r.createElement(m,o({ref:t},d))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=u;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var s=2;s<a;s++)o[s]=n[s];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},2256:function(e,t,n){n.r(t),n.d(t,{assets:function(){return s},contentTitle:function(){return l},default:function(){return u},frontMatter:function(){return o},metadata:function(){return p},toc:function(){return d}});n(27378);var r=n(35318);function i(){return i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i.apply(this,arguments)}function a(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}const o={id:"Framebuffer orientation",slug:"/platform-specific/android/android-developing/android-graphics/vulkan-swapchain-pre-rotation"},l="Framebuffer orientation",p={unversionedId:"unity/platform-specific/android/android-developing/android-graphics/Framebuffer orientation",id:"version-Unity@2022.1/unity/platform-specific/android/android-developing/android-graphics/Framebuffer orientation",title:"Framebuffer orientation",description:"If your application\u2019s framebuffer orientation doesn\u2019t match the device\u2019s native display orientation (portrait, for most devices), Android rotates the application\u2019s framebuffer to match the device\u2019s display every frame. Depending on the device\u2019s hardware capabilities, this additional rotation can negatively affect performance. If your application uses the Vulkan Graphics API and the device supports Vulkan, Unity can apply this rotation during rendering which reduces the performance impact of the rotation. This is called pre-rotation.",source:"@site/versioned_docs/version-Unity@2022.1/unity/platform-specific/android/android-developing/android-graphics/vulkan-swapchain-pre-rotation.md",sourceDirName:"unity/platform-specific/android/android-developing/android-graphics",slug:"/platform-specific/android/android-developing/android-graphics/vulkan-swapchain-pre-rotation",permalink:"/en/docs/platform-specific/android/android-developing/android-graphics/vulkan-swapchain-pre-rotation",editUrl:"https://github.com/danyow/danyow.github.io/edit/main/docs/unity/platform-specific/android/android-developing/android-graphics/vulkan-swapchain-pre-rotation.md",tags:[],version:"Unity@2022.1",lastUpdatedBy:"danyow",lastUpdatedAt:1648742180,formattedLastUpdatedAt:"3/31/2022",frontMatter:{id:"Framebuffer orientation",slug:"/platform-specific/android/android-developing/android-graphics/vulkan-swapchain-pre-rotation"},sidebar:"unity",previous:{title:"Android \u5355\u901a\u9053\u7acb\u4f53\u6e32\u67d3",permalink:"/en/docs/platform-specific/android/android-developing/android-graphics/android-single-pass-stereo-rendering"},next:{title:"Input for Android devices",permalink:"/en/docs/platform-specific/android/android-developing/android-input"}},s={},d=[{value:"Using pre-rotation in Unity",id:"using-pre-rotation-in-unity",level:2},{value:"How Unity applies pre-rotation",id:"how-unity-applies-pre-rotation",level:2},{value:"\u9650\u5236",id:"\u9650\u5236",level:2},{value:"\u9605\u8bfb\u66f4\u591a\u4fe1\u606f",id:"\u9605\u8bfb\u66f4\u591a\u4fe1\u606f",level:2}],c={toc:d};function u(e){var{components:t}=e,n=a(e,["components"]);return(0,r.kt)("wrapper",i({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",i({},{id:"framebuffer-orientation"}),"Framebuffer orientation"),(0,r.kt)("p",null,"If your application\u2019s framebuffer orientation doesn\u2019t match the device\u2019s native display orientation (portrait, for most devices), Android rotates the application\u2019s framebuffer to match the device\u2019s display every frame. Depending on the device\u2019s hardware capabilities, this additional rotation can negatively affect performance. If your application uses the ",(0,r.kt)("a",i({parentName:"p"},{href:"/en/docs/platform-specific/android/android-getting-started/class-player-settings-android"}),"Vulkan Graphics API")," and the device supports Vulkan, Unity can apply this rotation during rendering which reduces the performance impact of the rotation. This is called ",(0,r.kt)("a",i({parentName:"p"},{href:"https://android-developers.googleblog.com/2020/02/handling-device-orientation-efficiently.html"}),"pre-rotation"),"."),(0,r.kt)("h2",i({},{id:"using-pre-rotation-in-unity"}),"Using pre-rotation in Unity"),(0,r.kt)("p",null,"To make Unity apply pre-rotation, you can use C# scripts or the Unity editor:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Through C# scripts: Set ",(0,r.kt)("a",i({parentName:"li"},{href:"https://docs.unity3d.com/cn/2022.1/Manual/PlayerSettings-vulkanEnablePreTransform.html"}),"PlayerSettings.vulkanEnablePreTransform")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"true"),"."),(0,r.kt)("li",{parentName:"ul"},"Through the Unity Editor:"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Select  ",(0,r.kt)("strong",{parentName:"li"},"Edit"),"  ",">","  ",(0,r.kt)("strong",{parentName:"li"},"Project Settings")," ."))),(0,r.kt)("li",{parentName:"ul"},"In the Project settings window, select the  ",(0,r.kt)("strong",{parentName:"li"},"Player"),"  tab, then open ",(0,r.kt)("a",i({parentName:"li"},{href:"/en/docs/platform-specific/android/android-getting-started/class-player-settings-android"}),"Android Player Settings"),":",(0,r.kt)("br",null),(0,r.kt)("img",i({parentName:"li"},{src:"https://docs.unity3d.com/cn/2022.1/uploads/Main/android-player-settings-tab.png",alt:"android-player-settings-tab.png"}))),(0,r.kt)("li",{parentName:"ul"},"In the  ",(0,r.kt)("strong",{parentName:"li"},"Other Setting")," s section, enable  ",(0,r.kt)("strong",{parentName:"li"},"Apply display rotation during rendering")," .")),(0,r.kt)("h2",i({},{id:"how-unity-applies-pre-rotation"}),"How Unity applies pre-rotation"),(0,r.kt)("p",null,"Unity applies pre-rotation when it renders directly to the device\u2019s backbuffer, not when it renders to a ",(0,r.kt)("a",i({parentName:"p"},{href:"/en/docs/graphics/textures/class-render-texture"}),"Render Texture"),". To apply the rotation, Unity modifies the projection matrix which affects the ",(0,r.kt)("inlineCode",{parentName:"p"},"UNITY_MATRIX_MVP")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"UNITY_MATRIX_P")," ",(0,r.kt)("a",i({parentName:"p"},{href:"/en/docs/graphics/shaders/shader-writing/sl-shader-programs/sl-unity-shader-variables"}),"Built-in shader variables"),". This means that Unity applies the rotation in the vertex shader."),(0,r.kt)("p",null,"Using pre-rotation doesn\u2019t affect the behavior of Unity\u2019s C# API. For example, you can still use ",(0,r.kt)("inlineCode",{parentName:"p"},"Screen.width")," to access the width of the screen. The same applies to viewports and ",(0,r.kt)("a",i({parentName:"p"},{href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/Rendering.CommandBuffer.EnableScissorRect.html"}),"scissor rects"),". Unity adjusts these as needed, and also handles readback operations from the backbuffer such as Grab Pass, ReadPixels, or Screenshot."),(0,r.kt)("p",null,"Unity provides utility macros to handle special cases in shaders (for more information, see the ",(0,r.kt)("a",i({parentName:"p"},{href:"#%E9%99%90%E5%88%B6"}),"Limitations")," section below)."),(0,r.kt)("p",null,"\u4ec5\u5f53\u4ee5\u4e0b\u6240\u6709\u6761\u4ef6\u90fd\u4e3a\u771f\u65f6\u624d\u5b9a\u4e49\u5b8f UNITY","_","PRETRANSFORM","_","TO","_","DISPLAY","_","ORIENTATION\uff08\u5426\u5219\uff0c\u672a\u5b9a\u4e49\uff09\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"preTransform")," \u5728\u64ad\u653e\u5668\u8bbe\u7f6e\u4e2d\u542f\u7528"),(0,r.kt)("li",{parentName:"ul"},"\u5e73\u53f0\u8bbe\u7f6e\u4e3a Android"),(0,r.kt)("li",{parentName:"ul"},"\u56fe\u5f62 API \u8bbe\u7f6e\u4e3a Vulkan")),(0,r.kt)("p",null,"UNITY","_","DISPLAY","_","ORIENTATION","_","PRETRANSFORM \u662f\u4e00\u4e2a\u5e38\u91cf\uff0c\u8bbe\u7f6e\u4e3a\u5f53\u524d ",(0,r.kt)("inlineCode",{parentName:"p"},"preTransform")," \u65cb\u8f6c\u3002\u5b83\u7684\u503c\u662f\u4ee5\u4e0b\u4e4b\u4e00\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"UNITY","_","DISPLAY","_","ORIENTATION","_","0"),(0,r.kt)("li",{parentName:"ul"},"UNITY","_","DISPLAY","_","ORIENTATION","_","90"),(0,r.kt)("li",{parentName:"ul"},"UNITY","_","DISPLAY","_","ORIENTATION","_","180"),(0,r.kt)("li",{parentName:"ul"},"UNITY","_","DISPLAY","_","ORIENTATION","_","270")),(0,r.kt)("p",null,"\u5982\u679c UNITY","_","PRETRANSFORM","_","TO","_","DISPLAY","_","ORIENTATION \u672a\u5b9a\u4e49\uff0c\u6216\u8005\u5f53\u6e32\u67d3\u5230\u6e32\u67d3\u7eb9\u7406\u65f6\uff0cUNITY","_","DISPLAY","_","ORIENTATION","_","PRETRANSFORM \u7684\u503c\u662f UNITY","_","DISPLAY","_","ORIENTATION","_","0\u3002"),(0,r.kt)("p",null,"UNITY","_","DISPLAY","_","ORIENTATION","_","PRETRANSFORM is translated into a Vulkan specialization constant, which makes it efficient to use in if or switch statements."),(0,r.kt)("h2",i({},{id:"\u9650\u5236"}),"\u9650\u5236"),(0,r.kt)("p",null,"\u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u542f\u7528 preTransform\uff0c\u5219 Unity \u9879\u76ee\u53ef\u80fd\u9700\u8981\u989d\u5916\u4fee\u6539\uff0c\u7136\u540e\u624d\u80fd\u4f7f\u7528\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4e0d\u4f7f\u7528 Unity \u6295\u5f71\u77e9\u9635\u7684\u7740\u8272\u5668"),(0,r.kt)("li",{parentName:"ul"},"\u4f9d\u8d56\u4e8e\u7247\u5143\u7740\u8272\u5668\u4e2d\u5f53\u524d\u50cf\u7d20\u4f4d\u7f6e\u7684\u7740\u8272\u5668 (",(0,r.kt)("inlineCode",{parentName:"li"},"SV_Position"),")"),(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u5c4f\u5e55\u7a7a\u95f4\u5bfc\u6570\uff08ddx\u3001ddy\uff09\u7684\u7740\u8272\u5668"),(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528 Vulkan \u4ea4\u6362\u94fe\u56fe\u50cf\u7684\u539f\u751f\u6e32\u67d3\u63d2\u4ef6\u53ef\u80fd\u9700\u8981\u4fee\u6539"),(0,r.kt)("li",{parentName:"ul"},"\u5728 MRT \u8bbe\u7f6e\u4e2d\u901a\u8fc7 Unity RenderPass API \u540c\u65f6\u4f7f\u7528\u540e\u5907\u7f13\u51b2\u533a\u4e0e\u5176\u4ed6\u6e32\u67d3\u7eb9\u7406")),(0,r.kt)("p",null,"\u8fd9\u4e9b\u60c5\u51b5\u4ec5\u9002\u7528\u4e8e\u76f4\u63a5\u6e32\u67d3\u5230\u540e\u5907\u7f13\u51b2\u533a\u65f6\u3002"),(0,r.kt)("h2",i({},{id:"\u9605\u8bfb\u66f4\u591a\u4fe1\u606f"}),"\u9605\u8bfb\u66f4\u591a\u4fe1\u606f"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Android \u5f00\u53d1\u8005\u7f51\u7ad9\u4e0a\u7684 ",(0,r.kt)("a",i({parentName:"li"},{href:"https://developer.android.com/ndk/guides/graphics/design-notes?hl=sk&authuser=3"}),"Vulkan Design Guidelines"),"\u3002"),(0,r.kt)("li",{parentName:"ul"},"arm \u793e\u533a\u7f51\u7ad9\u4e0a\u7684 ",(0,r.kt)("a",i({parentName:"li"},{href:"https://community.arm.com/developer/tools-software/graphics/b/blog/posts/appropriate-use-of-surface-rotation"}),"Vulkan Mobile Best Practice - Appropriate Use of Surface Rotation"),"\u3002")))}u.isMDXComponent=!0}}]);