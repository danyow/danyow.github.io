"use strict";(self.webpackChunkdanyow_github_io=self.webpackChunkdanyow_github_io||[]).push([[1506],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return s}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=r.createContext({}),c=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=c(e.components);return r.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},k=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,p=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),k=c(n),s=a,u=k["".concat(p,".").concat(s)]||k[s]||m[s]||o;return n?r.createElement(u,l(l({ref:t},d),{},{components:n})):r.createElement(u,l({ref:t},d))}));function s(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=k;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var c=2;c<o;c++)l[c]=n[c];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}k.displayName="MDXCreateElement"},4416:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return i},default:function(){return k},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return d}});n(7294);var r=n(3905);function a(){return a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a.apply(this,arguments)}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const l={layout:"post",title:"\u90e8\u7f72\u65b0\u5b89\u88c5\u7684centos\u670d\u52a1\u5668",tags:["Mac","\u7b14\u8bb0"],comments:!0,date:"2020-01-28 09:42:42 +0800",published:!0},i=void 0,p={permalink:"/en/blog/2020/server",editUrl:"https://github.com/danyow/danyow.github.io/edit/main/blog/2020/server.mdx",source:"@site/blog/2020/server.mdx",title:"\u90e8\u7f72\u65b0\u5b89\u88c5\u7684centos\u670d\u52a1\u5668",description:"\u670d\u52a1\u5668\u94fe\u63a5\u8d85\u65f6\u89e3\u51b3",date:"2020-01-28T09:42:42.000Z",formattedDate:"January 28, 2020",tags:[{label:"Mac",permalink:"/en/blog/tags/mac"},{label:"\u7b14\u8bb0",permalink:"/en/blog/tags/\u7b14\u8bb0"}],readingTime:2.47,truncated:!1,authors:[],frontMatter:{layout:"post",title:"\u90e8\u7f72\u65b0\u5b89\u88c5\u7684centos\u670d\u52a1\u5668",tags:["Mac","\u7b14\u8bb0"],comments:!0,date:"2020-01-28 09:42:42 +0800",published:!0},prevItem:{title:"Scoop\u7684\u5b89\u88c5",permalink:"/en/blog/2019/scoop"},nextItem:{title:"Rust",permalink:"/en/blog/2019/rust"}},c={authorsImageUrls:[]},d=[{value:"\u670d\u52a1\u5668\u94fe\u63a5\u8d85\u65f6\u89e3\u51b3",id:"\u670d\u52a1\u5668\u94fe\u63a5\u8d85\u65f6\u89e3\u51b3",level:2},{value:"\u51fa\u73b0\u62a5\u9519",id:"\u51fa\u73b0\u62a5\u9519",level:2},{value:"\u5b89\u88c5<code>docker</code>",id:"\u5b89\u88c5docker",level:2},{value:"\u521b\u5efa <code>Dockerfile</code>",id:"\u521b\u5efa-dockerfile",level:2},{value:"\u76f4\u63a5\u90e8\u7f72\u9879\u76ee",id:"\u76f4\u63a5\u90e8\u7f72\u9879\u76ee",level:2}],m={toc:d};function k(e){var{components:t}=e,n=o(e,["components"]);return(0,r.kt)("wrapper",a({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",a({},{id:"\u670d\u52a1\u5668\u94fe\u63a5\u8d85\u65f6\u89e3\u51b3"}),"\u670d\u52a1\u5668\u94fe\u63a5\u8d85\u65f6\u89e3\u51b3"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"vim /etc/ssh/sshd_config")," \u4fee\u6539\u91cc\u9762\u7684\u4e24\u4e2a\u53c2\u6570"),(0,r.kt)("pre",null,(0,r.kt)("code",a({parentName:"pre"},{className:"language-config"}),"ClientAliveInterval 60\nClientAliveCountMax 60\n")),(0,r.kt)("p",null,"\u7136\u540e\u91cd\u542f",(0,r.kt)("inlineCode",{parentName:"p"},"ssh")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"systemctl restart ssh")),(0,r.kt)("h2",a({},{id:"\u51fa\u73b0\u62a5\u9519"}),"\u51fa\u73b0\u62a5\u9519"),(0,r.kt)("p",null,"\u5185\u5bb9",(0,r.kt)("inlineCode",{parentName:"p"},"Failed to set locale, defaulting to C.UTF-8")),(0,r.kt)("p",null,"\u6267\u884c",(0,r.kt)("inlineCode",{parentName:"p"},'echo "export LC_ALL=en_US.UTF-8"  >>  /etc/profile')),(0,r.kt)("h2",a({},{id:"\u5b89\u88c5docker"}),"\u5b89\u88c5",(0,r.kt)("inlineCode",{parentName:"h2"},"docker")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5378\u8f7d\u65e7\u7684\u7248\u672c"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",a({parentName:"pre"},{className:"language-shell"}),"sudo yum remove docker \\\n                docker-client \\\n                docker-client-latest \\\n                docker-common \\\n                docker-latest \\\n                docker-latest-logrotate \\\n                docker-logrotate \\\n                docker-engine\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5b89\u88c5\u4f9d\u8d56"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"sudo yum install -y yum-utils  device-mapper-persistent-data  lvm2"),"\n",(0,r.kt)("inlineCode",{parentName:"p"},"sudo yum-config-manager  --add-repo   https://download.docker.com/linux/centos/docker-ce.repo"),"\n",(0,r.kt)("inlineCode",{parentName:"p"},"sudo yum install docker-ce docker-ce-cli containerd.io"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u66f4\u65b0containerd.io"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"dnf install https://download.docker.com/linux/centos/7/x86_64/stable/Packages/containerd.io-1.2.6-3.3.el7.x86_64.rpm"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5b89\u88c5"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"sudo yum install docker-ce docker-ce-cli containerd.io"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u542f\u52a8docker"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"sudo systemctl start docker")))),(0,r.kt)("h2",a({},{id:"\u521b\u5efa-dockerfile"}),"\u521b\u5efa ",(0,r.kt)("inlineCode",{parentName:"h2"},"Dockerfile")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u521b\u5efa ",(0,r.kt)("inlineCode",{parentName:"p"},"docker/Dockerfile")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"mkdir docker && cd docker && vim Dockerfile"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u52a0\u5165\u4e0b\u9762\u5185\u5bb9"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",a({parentName:"pre"},{className:"language-docker"}),'FROM jenkins/jenkins:lts\nUSER root\nWORKDIR /dotnet\nRUN wget -O dotnet.tar.gz https://download.visualstudio.microsoft.com/download/pr/c4b503d6-2f41-4908-b634-270a0a1dcfca/c5a20e42868a48a2cd1ae27cf038044c/dotnet-sdk-3.1.101-linux-x64.tar.gz\nRUN tar zxf dotnet.tar.gz -C ./\nRUN rm -rf dotnet.tar.gz\nENV PATH="${PATH}:/dotnet:/var/jenkins_home/.dotnet/tools"\nENV DOTNET_ROOT="/dotnet"\nRUN apt update -y\nRUN apt install icu-devtools vim zip unzip -y\nRUN usermod -a -G root jenkins\nUSER jenkins\n')),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"\u8fd9\u4e2aDocker\u955c\u50cf\u57fa\u4e8ejenkins"),(0,r.kt)("li",{parentName:"ol"},"\u8bbe\u7f6e\u5f53\u524d\u7528\u6237\u4e3aroot\uff0c\u56e0\u4e3a\u540e\u9762\u5b89\u88c5\u9700\u8981\u4f7f\u7528root"),(0,r.kt)("li",{parentName:"ol"},"\u8bbe\u7f6e\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55\u4e3adotnet"),(0,r.kt)("li",{parentName:"ol"},"\u4e0b\u8f7ddotnet SDK\u5305\uff0c\u4fdd\u5b58\u4e3adotnet.tar.gz\u3002\u8fd9\u91cc\u8981\u6ce8\u610f\u4e0b\u8f7d\u6b63\u786e\u7248\u672c\u7684SDK\uff0c\u53ef\u524d\u5f80\u5fae\u8f6f\u5b98\u65b9\u7f51\u7ad9\u83b7\u53d6\u4e0b\u8f7d\u94fe\u63a5\uff1a",(0,r.kt)("a",a({parentName:"li"},{href:"https://dotnet.microsoft.com/download"}),"https://dotnet.microsoft.com/download")),(0,r.kt)("li",{parentName:"ol"},"\u89e3\u538bdotnet SDK\u5230\u5f53\u524d\u76ee\u5f55\uff0c\u5373/dotnet\u76ee\u5f55"),(0,r.kt)("li",{parentName:"ol"},"\u5220\u9664dotnet SDK\u5305"),(0,r.kt)("li",{parentName:"ol"},"\u628adotnet\u76ee\u5f55\u548cdotnet tools\u76ee\u5f55\u6dfb\u52a0\u5230\u73af\u5883\u53d8\u91cfPATH\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4f7f\u7528dotnet\u547d\u4ee4\u4e86"),(0,r.kt)("li",{parentName:"ol"},"\u8bbe\u7f6eDOTNET_ROOT\u53d8\u91cf"),(0,r.kt)("li",{parentName:"ol"},"\u66f4\u65b0\u6e90"),(0,r.kt)("li",{parentName:"ol"},"\u5b89\u88c5\u4e00\u4e9b\u5fc5\u9700\u7684\uff0c\u5e38\u7528\u7684\u5de5\u5177\u5305\uff0c\u5176\u4e2dicu-devtools\u662f\u8fd0\u884cdotnet\u9700\u8981\u7684"),(0,r.kt)("li",{parentName:"ol"},"\u4fee\u6539jenkins\u7528\u6237\u5230root\u9644\u52a0\u7ec4"),(0,r.kt)("li",{parentName:"ol"},"\u8bbe\u7f6e\u5f53\u524d\u7528\u6237\u4e3ajenkins"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u751f\u6210\u955c\u50cf"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"docker build -t jenkins:dotnet ."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u67e5\u770b\u6240\u6709\u955c\u50cf"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"docker image"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u8fd0\u884c",(0,r.kt)("inlineCode",{parentName:"p"},"docker"),"\u5b9e\u4f8b"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"docker run -p 8080:8080 -p 50000:50000 --name jenkins jenkins:dotnet"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u83b7\u53d6\u5bc6\u7801\u548c\u8bbf\u95ee\u94fe\u63a5"),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"\u81ea\u5b9a\u4e49\u5b89\u88c5"),(0,r.kt)("li",{parentName:"ol"},"\u8865\u5145\u5b89\u88c5",(0,r.kt)("inlineCode",{parentName:"li"},"GitHub"),"\u548c",(0,r.kt)("inlineCode",{parentName:"li"},"Publish Over SSH")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u6dfb\u52a0\u7f16\u8bd1\u6267\u884c\u811a\u672c"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"dotnet publish"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u6784\u5efa")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u6dfb\u52a0 ",(0,r.kt)("inlineCode",{parentName:"p"},"github webhook")))),(0,r.kt)("h2",a({},{id:"\u76f4\u63a5\u90e8\u7f72\u9879\u76ee"}),"\u76f4\u63a5\u90e8\u7f72\u9879\u76ee"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5b89\u88c5",(0,r.kt)("inlineCode",{parentName:"p"},"git")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"yum install git"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u514b\u9686")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"docker build -t dotnet ."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"docker run -d -p 8080:80 dotnet")))))}k.isMDXComponent=!0}}]);