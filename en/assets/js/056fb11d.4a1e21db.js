"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[74482],{35318:function(e,t,r){r.d(t,{Zo:function(){return u},kt:function(){return m}});var n=r(27378);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=n.createContext({}),p=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},u=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(r),m=a,g=c["".concat(l,".").concat(m)]||c[m]||d[m]||o;return r?n.createElement(g,i(i({ref:t},u),{},{components:r})):n.createElement(g,i({ref:t},u))}));function m(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var p=2;p<o;p++)i[p]=r[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}c.displayName="MDXCreateElement"},18201:function(e,t,r){r.r(t),r.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return c},frontMatter:function(){return i},metadata:function(){return l},toc:function(){return u}});r(27378);var n=r(35318);function a(){return a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a.apply(this,arguments)}function o(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}const i={id:"API updater",slug:"/unity-overview/upgrade-guides/apiupdater"},s="API updater",l={unversionedId:"unity/unity-overview/upgrade-guides/API updater",id:"version-Unity@2022.1/unity/unity-overview/upgrade-guides/API updater",title:"API updater",description:"To improve usability and performance, Unity might change the way classes, functions and properties (the API) work. Occasionally, these improvements might introduce breaking changes when moving from one major Unity version to another.",source:"@site/versioned_docs/version-Unity@2022.1/unity/unity-overview/upgrade-guides/apiupdater.md",sourceDirName:"unity/unity-overview/upgrade-guides",slug:"/unity-overview/upgrade-guides/apiupdater",permalink:"/en/docs/unity-overview/upgrade-guides/apiupdater",editUrl:"https://github.com/danyow/danyow.github.io/edit/main/docs/unity/unity-overview/upgrade-guides/apiupdater.md",tags:[],version:"Unity@2022.1",lastUpdatedBy:"danyow",lastUpdatedAt:1648742180,formattedLastUpdatedAt:"3/31/2022",frontMatter:{id:"API updater",slug:"/unity-overview/upgrade-guides/apiupdater"},sidebar:"unity",previous:{title:"\u5347\u7ea7 Unity",permalink:"/en/docs/unity-overview/upgrade-guides/upgrade-guides"},next:{title:"\u65e7\u7248\u5347\u7ea7\u6307\u5357",permalink:"/en/docs/unity-overview/upgrade-guides/upgrade-guide-legacy/upgrade-guide-legacy"}},p={},u=[{value:"Using the API updater",id:"using-the-api-updater",level:2},{value:"Command line arguments related to API Updater",id:"command-line-arguments-related-to-api-updater",level:2},{value:"\u65e5\u5fd7\u8bb0\u5f55",id:"\u65e5\u5fd7\u8bb0\u5f55",level:2},{value:"\u6545\u969c\u6392\u9664",id:"\u6545\u969c\u6392\u9664",level:2},{value:"API Updating failed. Check previous console messages.",id:"api-updating-failed-check-previous-console-messages",level:3}],d={toc:u};function c(e){var{components:t}=e,r=o(e,["components"]);return(0,n.kt)("wrapper",a({},d,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",a({},{id:"api-updater"}),"API updater"),(0,n.kt)("p",null,"To improve usability and performance, Unity might change the way classes, functions and properties (the API) work. Occasionally, these improvements might introduce breaking changes when moving from one major Unity version to another."),(0,n.kt)("p",null,"To minimize the impact of breaking changes, the API updater identifies and updates obsolete code in your scripts and assemblies."),(0,n.kt)("p",null,"The API updater consists of the ScriptUpdater and the AssemblyUpdater, which are responsible for updating source code (scripts) and assemblies (dll files) respectively."),(0,n.kt)("p",null," ",(0,n.kt)("strong",{parentName:"p"},"Note")," : The API Updater can only fix certain errors and warnings in the API. These are indicated as  ",(0,n.kt)("strong",{parentName:"p"},"UnityUpgradable"),"  in the console message. You must manually resolve other errors or warnings that the API Updater cannot handle."),(0,n.kt)("h2",a({},{id:"using-the-api-updater"}),"Using the API updater"),(0,n.kt)("p",null,"When a ",(0,n.kt)("a",a({parentName:"p"},{href:"/en/docs/scripting-section/unity-architecture/script-compilation/script-compilation"}),"script compilation")," is triggered, the API updater runs automatically. For example, this occurs when you:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Open a project."),(0,n.kt)("li",{parentName:"ul"},"Import a package."),(0,n.kt)("li",{parentName:"ul"},"Save changes to a script.")),(0,n.kt)("p",null,"The API updater offers to update any obsolete code that it detects. If you accept, it rewrites any obsolete code with the recommended updated version of the API."),(0,n.kt)("p",null,"For example, the API updater would convert the following obsolete statement from:"),(0,n.kt)("pre",null,(0,n.kt)("code",a({parentName:"pre"},{}),"light.color = Color.red;\n")),(0,n.kt)("p",null,"to:"),(0,n.kt)("pre",null,(0,n.kt)("code",a({parentName:"pre"},{}),"GetComponent&lt;Light&gt;().color = Color.red;\n")),(0,n.kt)("p",null,"The steps below describe the workflow of the API updater when Unity triggers a script compilation:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Unity triggers a script compilation."),(0,n.kt)("li",{parentName:"ol"},"The API updater checks for updatable compiler errors or warnings that it can handle.",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"If it doesn\u2019t find any errors or warnings, the process ends."),(0,n.kt)("li",{parentName:"ul"},"If it finds any errors or warnings, it displays a dialog offering an automatic update.",(0,n.kt)("br",null),"Close the Editor and back up your project before you let the API updater update your scripts or assemblies. When you reopen your project, Unity compiles your scripts and triggers the API updater."))),(0,n.kt)("li",{parentName:"ol"},"If you accept the update, the API updater updates all scripts in the same compilation unit."),(0,n.kt)("li",{parentName:"ol"},"The API Updater repeats this process until it detects no more errors or warnings that it can handle.")),(0,n.kt)("p",null,"The updater can run multiple times if scripts with obsolete code fall into different compilation passes, for example, editor scripts."),(0,n.kt)("p",null,"If you don\u2019t allow the API updater to update your scripts, the console displays any script errors or warnings. Errors or warnings which the API updater could resolve display ( ",(0,n.kt)("strong",{parentName:"p"},"UnityUpgradable")," ) in the message."),(0,n.kt)("p",null,"If your script has other errors which prevent the API updater from running successfully, the Console displays a message to inform you of this. You must resolve those errors before the API Updater can complete the updates."),(0,n.kt)("h2",a({},{id:"command-line-arguments-related-to-api-updater"}),"Command line arguments related to API Updater"),(0,n.kt)("p",null,"When running Unity in batch mode from the command line, use the ",(0,n.kt)("inlineCode",{parentName:"p"},"-accept-apiupdate")," option to run the API updater. For more information, see ",(0,n.kt)("a",a({parentName:"p"},{href:"/en/docs/unity-overview/editor-features/command-line-arguments/command-line-arguments"}),"Command Line Arguments"),"."),(0,n.kt)("h2",a({},{id:"\u65e5\u5fd7\u8bb0\u5f55"}),"\u65e5\u5fd7\u8bb0\u5f55"),(0,n.kt)("p",null,"The API updater logs changes it makes to any assemblies to the ",(0,n.kt)("a",a({parentName:"p"},{href:"/en/docs/unity-overview/analysis/log-files"}),"Editor log"),". To control how much information is logged, set the UNITY","_","APIUPDATER","_","LOG","_","THRESHOLD environment variable to the desired log threshold and start Unity. For example:"),(0,n.kt)("p",null,"Windows\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",a({parentName:"pre"},{}),"c:&gt; set UNITY_APIUPDATER_LOG_THRESHOLD=Debug\nc:&gt; \\path\\to\\unity\\Unity.exe\n")),(0,n.kt)("p",null,"On Linux:"),(0,n.kt)("pre",null,(0,n.kt)("code",a({parentName:"pre"},{}),"$ export UNITY_APIUPDATER_LOG_THRESHOLD=Debug\n$ /path/to/unity/Unity\n")),(0,n.kt)("p",null,"\u5728 Mac \u4e0a\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",a({parentName:"pre"},{}),"$ export UNITY_APIUPDATER_LOG_THRESHOLD=Debug\n$ /path/to/unity/Unity\n")),(0,n.kt)("p",null," ",(0,n.kt)("strong",{parentName:"p"},"Note")," : You can also use ",(0,n.kt)("a",a({parentName:"p"},{href:"https://en.wikipedia.org/wiki/Version_control"}),"version control")," to see changes the API updater makes to a project\u2019s scripts."),(0,n.kt)("p",null,"When AssemblyUpdater has finished, the Editor.log displays the changes. For example:"),(0,n.kt)("pre",null,(0,n.kt)("code",a({parentName:"pre"},{}),"[AssemblyUpdater] Property access to 'UnityEngine.Rigidbody\nUnityEngine.GameObject::get_rigidbody()' in 'System.Void\nTest.ClassReferencingObsoleteUnityAPIThroughEditorAssembly::Run()' replaced with 'T\nUnityEngine.GameObject::GetComponent&lt;UnityEngine.Rigidbody&gt;()'.\n")),(0,n.kt)("p",null,"The table below describes the values for the ",(0,n.kt)("inlineCode",{parentName:"p"},"UNITY_APIUPDATER_LOG_THRESHOLD")," environment variable:"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",a({parentName:"tr"},{align:null}),"Log threshold"),(0,n.kt)("th",a({parentName:"tr"},{align:null}),"\u63cf\u8ff0"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",a({parentName:"tr"},{align:null}),(0,n.kt)("strong",{parentName:"td"},"Error"),"  (default value)"),(0,n.kt)("td",a({parentName:"tr"},{align:null}),"The API updater only logs  ",(0,n.kt)("strong",{parentName:"td"},"Error"),"  messages. Error messages are logged when the API updater fails to apply a specific update, which requires you to take corrective action (usually requesting the original assembly author to provide an updated version of the assembly).")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",a({parentName:"tr"},{align:null}),(0,n.kt)("strong",{parentName:"td"},"Warning")),(0,n.kt)("td",a({parentName:"tr"},{align:null}),"The API updater logs  ",(0,n.kt)("strong",{parentName:"td"},"Warning"),"  and  ",(0,n.kt)("strong",{parentName:"td"},"Error"),"  messages. Warning messages are logged when the API updater applies a change that the user might need to review.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",a({parentName:"tr"},{align:null}),(0,n.kt)("strong",{parentName:"td"},"Info")),(0,n.kt)("td",a({parentName:"tr"},{align:null}),"The API updater logs  ",(0,n.kt)("strong",{parentName:"td"},"Informational")," ,  ",(0,n.kt)("strong",{parentName:"td"},"Warning"),"  and  ",(0,n.kt)("strong",{parentName:"td"},"Error"),"  messages. Info messages include updates applied by the AssemblyUpdater.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",a({parentName:"tr"},{align:null}),(0,n.kt)("strong",{parentName:"td"},"Debug")),(0,n.kt)("td",a({parentName:"tr"},{align:null}),"The API updater logs all messages. This is useful for troubleshooting, for example if you have issues with the API updater that you want to report to Unity.")))),(0,n.kt)("h2",a({},{id:"\u6545\u969c\u6392\u9664"}),"\u6545\u969c\u6392\u9664"),(0,n.kt)("h3",a({},{id:"api-updating-failed-check-previous-console-messages"}),"API Updating failed. Check previous console messages."),(0,n.kt)("p",null,"The API updater couldn\u2019t update all obsolete code. This can occur if the updater can\u2019t save its changes, for example if the user has read-only permissions on the script."),(0,n.kt)("p",null,"Check the previous lines in the console to see any problems that occurred during the update process."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"2018\u201307\u201331 \u9875\u9762\u5df2\u4fee\u8ba2"),(0,n.kt)("li",{parentName:"ul"},"Unity 2017.2 \u4e2d\u6dfb\u52a0\u4e86\u201caccept-apiupdate\u201d\u547d\u4ee4\u884c\u9009\u9879"),(0,n.kt)("li",{parentName:"ul"},"\u5728 Unity ",(0,n.kt)("a",a({parentName:"li"},{href:"https://docs.unity3d.com/2018.3/Documentation/Manual/30_search.html?q=newin20183"}),"2018.3")," \u7248\u672c\u4e2d\u6539\u8fdb\u4e86 AssemblyUpdater \u65e5\u5fd7\u8bb0\u5f55 NewIn20183")))}c.isMDXComponent=!0}}]);