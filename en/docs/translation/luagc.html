<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-translation/luagc">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/en/blog/rss.xml" title="Danyow RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/blog/atom.xml" title="Danyow Atom Feed">
<link rel="alternate" type="application/json" href="/en/blog/feed.json" title="Danyow JSON Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-141789564-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-141789564-1",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Danyow" href="/en/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/en/changelog/rss.xml" title="æ—¥å¿— RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/changelog/atom.xml" title="æ—¥å¿— Atom Feed">
<link rel="alternate" type="application/json" href="/en/changelog/feed.json" title="æ—¥å¿— JSON Feed">
<link rel="icon" href="/en/img/logo.png">
<link rel="manifest" href="/en/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/en/img/logo.png">
<link rel="mask-icon" href="/en/img/logo.png" color="rgb(62, 204, 94)">
<meta name="msapplication-TileImage" content="/en/img/logo.png">
<meta name="msapplication-TileColor" content="#000">
<link rel="stylesheet" href="/katex/katex.min.css"><title data-rh="true">Luaçš„åƒåœ¾å›æ”¶ | Danyow</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://danyow.github.io/en/docs/translation/luagc"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Luaçš„åƒåœ¾å›æ”¶ | Danyow"><meta data-rh="true" name="description" content="Youtubeè§†é¢‘åœ°å€"><meta data-rh="true" property="og:description" content="Youtubeè§†é¢‘åœ°å€"><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://danyow.github.io/en/docs/translation/luagc"><link data-rh="true" rel="alternate" href="https://danyow.github.io/docs/translation/luagc" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://danyow.github.io/en/docs/translation/luagc" hreflang="en"><link data-rh="true" rel="alternate" href="https://danyow.github.io/docs/translation/luagc" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://S3KRFC060Q-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/en/assets/css/styles.bff76bc0.css">
<link rel="preload" href="/en/assets/js/runtime~main.ff5b954a.js" as="script">
<link rel="preload" href="/en/assets/js/main.7d9fb09f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_BxGa">Skip to main content</a></div><div class="announcementBar_yyVl" role="banner"><div class="announcementBarPlaceholder_Il1w"></div><div class="announcementBarContent_KFU1">â­ï¸ <a target="_blank" rel="noopener noreferrer" href="https://github.com/danyow/danyow.github.io">å¦‚å–œ, èµæ˜Ÿ</a>  â­ï¸</div><button type="button" class="clean-btn close announcementBarClose_axA0" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_FcXi"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/logo.svg" alt="Danyow Logo" class="themedImage_aIr_ themedImage--light_DGIu" height="32" width="32"><img src="/en/img/logo-dark.svg" alt="Danyow Logo" class="themedImage_aIr_ themedImage--dark_RoHN" height="32" width="32"></div><b class="navbar__title">Danyow</b></a><a class="navbar__item navbar__link navbar__link--active" href="/en/docs">å‚¨å¤‡</a><a class="navbar__item navbar__link" href="/en/blog">åšå®¢</a><a class="navbar__item navbar__link" href="/en/changelog">æ—¥å¿—</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/en/docs">v0 ğŸš§</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/en/docs/translation/luagc">v0 ğŸš§</a></li><li><a href="https://danyow-jbufheovr-danyow.vercel.app/docs/unity-manual/unity-manual" target="_blank" rel="noopener noreferrer" class="dropdown__link">Unity@2022.1<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_GWqj"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://danyow-n1bljgzah-danyow.vercel.app/docs/lua/hello" target="_blank" rel="noopener noreferrer" class="dropdown__link">Lua@5.3<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_GWqj"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/en/versions">æ‰€æœ‰ç‰ˆæœ¬</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><span><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_NpMu"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/docs/translation/luagc" target="_self" rel="noopener noreferrer" class="dropdown__link">ä¸­æ–‡</a></li><li><a href="/en/docs/translation/luagc" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li><li><a href="https://github.com/danyow/danyow.github.io/issues/3526" target="_blank" rel="noopener noreferrer" class="dropdown__link">Help Us Translate<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_GWqj"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/danyow/danyow.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_IT2h colorModeToggle_o_qc"><button class="clean-btn toggleButton_pGki toggleButtonDisabled_vZLo" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_dYsV"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_WRF1"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_lGmL"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_zNSk"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_ecpa" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_NEdF"><div class="sidebar_Uz2u sidebarWithHideableNavbar_MFe1"><a tabindex="-1" class="sidebarLogo_iqfm" href="/en/"><img src="/en/img/logo.svg" alt="Danyow Logo" class="themedImage_aIr_ themedImage--light_DGIu" height="32" width="32"><img src="/en/img/logo-dark.svg" alt="Danyow Logo" class="themedImage_aIr_ themedImage--dark_RoHN" height="32" width="32"><b>Danyow</b></a><nav class="menu thin-scrollbar menu_XU2j menuWithAnnouncementBar_vo3y"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/audition">å…«è‚¡</a><button aria-label="Toggle the collapsible sidebar category &#x27;å…«è‚¡&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/glossary">æœ¯è¯­è¡¨</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs">å ä½ç¬¦</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/reprint">è½¬è½½</a><button aria-label="Toggle the collapsible sidebar category &#x27;è½¬è½½&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/en/docs/translation">ç¿»è¯‘</a><button aria-label="Toggle the collapsible sidebar category &#x27;ç¿»è¯‘&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/translation/boehm">Boehmåƒåœ¾å›æ”¶</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en/docs/translation/luagc">Luaçš„åƒåœ¾å›æ”¶</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_Essf"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_bqna"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_vJqy"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_ygLL"><div class="docItemContainer_yJzi"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_nmcO" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/en/">ğŸ </a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/en/docs/translation"><span itemprop="name">ç¿»è¯‘</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">Luaçš„åƒåœ¾å›æ”¶</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_aX8Q theme-doc-toc-mobile tocMobile_By44"><button type="button" class="clean-btn tocCollapsibleButton_Va7b">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Garbage Collection in Lua - Roberto Ierusalimschy</h1><blockquote><p><a href="https://www.youtube.com/watch?v=wGizKsOJQuE" target="_blank" rel="noopener noreferrer">Youtubeè§†é¢‘åœ°å€</a></p></blockquote><blockquote><p><a href="https://www.lua.org/wshop18/Ierusalimschy.pdf" target="_blank" rel="noopener noreferrer">Slideå¹»ç¯ç‰‡åœ°å€</a></p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="automatic-memory-management">Automatic Memory Management<a class="hash-link" href="#automatic-memory-management" title="Direct link to heading">â€‹</a></h2><ul><li>Releases memory automatically, when it is not needed anymore.</li><li>Two main approaches:<ul><li>Reference counting</li><li>Garbage collection</li></ul></li><li>Lua uses garbage collection.<ul><li>main reason: in dynamically-typed languages, reference count adds overhead
even if a program never allocates memory.</li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="è‡ªåŠ¨å†…å­˜ç®¡ç†">è‡ªåŠ¨å†…å­˜ç®¡ç†<a class="hash-link" href="#è‡ªåŠ¨å†…å­˜ç®¡ç†" title="Direct link to heading">â€‹</a></h3><ul><li>å½“å¯¹è±¡ä¸å†éœ€è¦æ—¶, è‡ªåŠ¨é‡Šæ”¾æ‰å¯¹è±¡å ç”¨çš„å†…å­˜.</li><li>ç›®å‰å¸‚é¢ä¸Šæœ‰ä¸¤ç§ä¸»æµæ–¹æ³•å®ç°ç”¨ä»¥è‡ªåŠ¨å†…å­˜ç®¡ç†:<ul><li>å¼•ç”¨è®¡æ•°</li><li>åƒåœ¾å›æ”¶</li></ul></li><li>å…¶ä¸­ <code>Lua</code> ä½¿ç”¨åƒåœ¾å›æ”¶.</li><li>ä¸»è¦åŸå› : åœ¨åŠ¨æ€ç±»å‹è¯­è¨€ä¸­, å³ä½¿ç¨‹åºä»ä¸åˆ†é…å†…å­˜, å¼•ç”¨è®¡æ•°ä¹Ÿä¼šå¢åŠ å¼€é”€.</li></ul><p>å› ä¸ºåœ¨åŠ¨æ€ç±»å‹çš„è¯­è¨€ä¸­ä½ ä¸çŸ¥é“å˜é‡çš„ç±»å‹, æ²¡æœ‰ç±»å‹å¼•ç”¨è®¡æ•°ä¼šå¢åŠ å¼€é”€, å³ä½¿ç¨‹åºä»ä¸åˆ†é…å†…å­˜.</p><p>å³ä½¿ç®€å•çš„æ“ä½œæ•°å­—æˆ–ä»…æ“ä½œå·²åˆ†é…ä½†æœªåˆ›å»ºæ–°åˆ†é…å€¼çš„åˆ†é…å€¼, æ‚¨ä»ä¼šä¸æ–­æ›´æ–°å¼•ç”¨è®¡æ•°, è¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å¼€é”€, å› æ­¤ <code>Lua</code>ä¸ä½¿ç”¨å¼•ç”¨è®¡æ•°.</p><hr><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="the-lua-gc">The Lua GC<a class="hash-link" href="#the-lua-gc" title="Direct link to heading">â€‹</a></h2><ul><li>All objects in Lua are subject to garbage collection.<ul><li>table, functions, &quot;modules&quot;, threads(coroutines) etc,</li></ul></li><li>Only objects accessible from the root set are preserved.<ul><li>root set: the registry and shared metatables.</li><li>the registry contains the global table (_G), the main thread, and
package.loaded.</li></ul></li><li>The collector operates on top of standard allocation functions.</li><li>All objects linked in a long list.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="luaçš„åƒåœ¾å›æ”¶">Luaçš„åƒåœ¾å›æ”¶<a class="hash-link" href="#luaçš„åƒåœ¾å›æ”¶" title="Direct link to heading">â€‹</a></h3><ul><li><code>Lua</code> ä¸­çš„æ‰€æœ‰å¯¹è±¡éƒ½éœ€è¦è¿›è¡Œåƒåœ¾å›æ”¶.<ul><li>è¡¨, å‡½æ•°, &quot;æ¨¡å—&quot;, çº¿ç¨‹(åç¨‹)ç­‰,</li></ul></li><li>ä»…ä¿ç•™ä»<code>root set</code>ä¸­å¯è®¿é—®çš„å¯¹è±¡.<ul><li><code>root set</code>: <code>registry</code>å’Œå…±äº«å…ƒè¡¨.</li><li><code>registry</code>åŒ…å«å…¨å±€è¡¨ (<code>_G</code>), ä¸»çº¿ç¨‹å’Œ<code>package.loaded</code>.</li></ul></li><li>æ”¶é›†å™¨æ“ä½œåœ¨æ ‡å‡†çš„åˆ†é…å‡½æ•°ä¹‹ä¸Šè¿›è¡Œ.</li><li>æ‰€æœ‰å¯¹è±¡éƒ½é“¾æ¥åˆ°ä¸€ä¸ª<code>long list</code>ä¸­.</li></ul><p><code>Lua</code> ç†è§£ä¸ºä¸€ä¸ªå¤§çš„ç”Ÿæ€ç³»ç»Ÿ, å½“å‡ºç°è®¸å¤šåƒåœ¾çš„æ—¶å€™, è¿›è¡Œè‡ªåŠ¨å›æ”¶ä¹‹åç¡®ä¿ç”Ÿæ€ç³»ç»Ÿèƒ½å›åˆ°æœ€åˆçš„çŠ¶æ€.</p><p>å…±äº«å…ƒè¡¨: åœ¨<code>Lua</code>æ˜¯å¥‡æ€ªçš„ç±»å‹, æ¯”å¦‚å‡½æ•°ç¼–å·, é™¤äº†è¡¨ä»¥å¤–çš„æ‰€æœ‰ä¸œè¥¿å’Œuserdataéƒ½æ˜¯å…±äº«çš„.
<code>standard allocation functions</code>: ä¾‹å¦‚æ¥è‡ªæ ‡å‡†Cåº“çš„<code>malloc</code>, <code>realloc</code>, <code>free</code>, <code>calloc</code>
ç­‰.</p><hr><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="lua-gc-until-version-50">Lua GC until Version 5.0<a class="hash-link" href="#lua-gc-until-version-50" title="Direct link to heading">â€‹</a></h2><ul><li>Basic mark &amp; sweep collector.</li><li>Mark: traverse the object graph, starting from the root set, marking the live
objects.</li><li>Sweep: traverse the long list of all objects, deleting those not marked.</li><li>Between mark and sweep, the collector separates and resurrects objects to be
finalized.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="lua-åœ¨-50-ä¹‹å‰çš„åƒåœ¾å›æ”¶"><code>Lua</code> åœ¨ 5.0 ä¹‹å‰çš„åƒåœ¾å›æ”¶<a class="hash-link" href="#lua-åœ¨-50-ä¹‹å‰çš„åƒåœ¾å›æ”¶" title="Direct link to heading">â€‹</a></h3><ul><li>åŸºç¡€çš„ <code>Mark &amp; Sweep</code> æ”¶é›†å™¨.</li><li>æ ‡è®°ï¼šéå†å¯¹è±¡å›¾, ä»<code>root set</code>å¼€å§‹, æ ‡è®°æ´»å¯¹è±¡.</li><li>æ¸…é™¤ï¼šéå†æ‰€æœ‰å¯¹è±¡çš„<code>long list</code>, åˆ é™¤é‚£äº›æ²¡æœ‰æ ‡è®°çš„.</li><li>åœ¨æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ä¸­, æ”¶é›†å™¨åˆ†ç¦»å¹¶æ¢å¤éœ€è¦æ‰§è¡Œ<code>finalized</code>çš„å¯¹è±¡.</li></ul><p>ä»¥ä¸Šæ­¥éª¤åŸºæœ¬éƒ½æ˜¯åŸå­æ€§çš„.</p><hr><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="the-collectors-pace">The Collector&#x27;s Pace<a class="hash-link" href="#the-collectors-pace" title="Direct link to heading">â€‹</a></h2><ul><li>The pace of a collector is a key component in system&#x27;s performance.</li><li>A collector that never runs has zero CPU cost, but a huge memory cost.</li><li>A collector that runs at all the time has zero memory overhead, but a huge CPU
cost.</li><li>The sweet spot is somewhere in between.<ul><li>New Collection when memory use is twice the use at the end of last
collection.</li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="æ”¶é›†å™¨çš„èŠ‚å¥">æ”¶é›†å™¨çš„èŠ‚å¥<a class="hash-link" href="#æ”¶é›†å™¨çš„èŠ‚å¥" title="Direct link to heading">â€‹</a></h3><ul><li>æ”¶é›†å™¨çš„èŠ‚å¥æ˜¯ç³»ç»Ÿæ€§èƒ½çš„å…³é”®ç»„æˆéƒ¨åˆ†.</li><li>å¦‚æœä¸€ä¸ªä»æ¥éƒ½ä¸è¿è¡Œçš„æ”¶é›†å™¨, é‚£ä¹ˆå…¶ <code>CPU</code> æˆæœ¬ä¸ºé›¶, ä½†å¯¹å†…å­˜åˆ™æ˜¯å·¨å¤§çš„æˆæœ¬.</li><li>è€Œå¦‚æœä¸€ä¸ªä¸€ç›´è¿è¡Œçš„æ”¶é›†å™¨, é‚£ä¹ˆå…¶å†…å­˜å¼€é”€ä¸ºé›¶, ä½† <code>CPU</code> å¼€é”€å·¨å¤§.</li><li>é‚£ä¹ˆå¹³è¡¡ç‚¹åˆ™ä»‹äºä¸¤è€…ä¹‹é—´.<ul><li>å½“å†…å­˜ä½¿ç”¨è¾¾åˆ°ä¸Šæ¬¡åƒåœ¾å›æ”¶ç»“æŸæ—¶çš„ä¸¤å€æ—¶è¿›è¡Œåƒåœ¾å›æ”¶è§¦å‘ä¸€æ¬¡æ–°çš„åƒåœ¾å›æ”¶.</li></ul></li></ul><hr><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="lua-gc-until-version-50defect">Lua GC until Version 5.0(defect)<a class="hash-link" href="#lua-gc-until-version-50defect" title="Direct link to heading">â€‹</a></h2><ul><li>Main drawback of Mark &amp; Sweep: pauses in the program execution during a GC
cycle can be very long.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="lua-åœ¨-50-ä¹‹å‰çš„åƒåœ¾å›æ”¶ç¼ºç‚¹"><code>Lua</code> åœ¨ 5.0 ä¹‹å‰çš„åƒåœ¾å›æ”¶(ç¼ºç‚¹)<a class="hash-link" href="#lua-åœ¨-50-ä¹‹å‰çš„åƒåœ¾å›æ”¶ç¼ºç‚¹" title="Direct link to heading">â€‹</a></h3><ul><li><code>Mark &amp; Sweep</code> çš„ä¸»è¦ç¼ºç‚¹ï¼šåœ¨ <code>GC</code> å‘¨æœŸä¸­ç¨‹åºæ‰§è¡Œçš„æš‚åœå¯èƒ½ä¼šå¾ˆé•¿.</li></ul><p>ä¹Ÿå°±æ˜¯äººä»¬ç§°ä¹‹ä¸ºçš„<code>stop the world</code>.</p><hr><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="51">5.1<a class="hash-link" href="#51" title="Direct link to heading">â€‹</a></h2><p>In version 5.1, Lua got an incremental collector. An <em>incremental</em> collector
interleaves the execution of the collector with the main program.</p><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="51-1">5.1<a class="hash-link" href="#51-1" title="Direct link to heading">â€‹</a></h3><p>åœ¨5.1ç‰ˆä¸­, é‡‡ç”¨äº†å¢é‡åƒåœ¾å›æ”¶ç­–ç•¥.å¢é‡åƒåœ¾å›æ”¶å™¨çš„åƒåœ¾å›æ”¶å¯ä»¥é€æ­¥è¿›è¡Œ, ä¸éœ€è¦ä¸€æ¬¡æ€§å®Œæˆ, é¿å…äº†å¯¹ç¨‹åºçš„é•¿æ—¶é—´æš‚åœ.</p><hr><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="the-mutator">The mutator<a class="hash-link" href="#the-mutator" title="Direct link to heading">â€‹</a></h2><ul><li>From the garbage collector&#x27;s point of view, the program is just some nuisance
changing the data it is trying to collect: the mutator!</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="the-mutatorä¸ç¨³å®šå› ç´ ">The mutator(ä¸ç¨³å®šå› ç´ )<a class="hash-link" href="#the-mutatorä¸ç¨³å®šå› ç´ " title="Direct link to heading">â€‹</a></h3><ul><li>ä»åƒåœ¾å›æ”¶å™¨çš„è§’åº¦æ¥çœ‹, ç¨‹åºè‡ªèº«å°±æ˜¯ä¸€ä¸ªå™ªéŸ³æºæ—¶å¸¸æ”¹å˜æ•°æ®å¯¼è‡´åƒåœ¾å›æ”¶æ“ä½œ!</li></ul><p>ä¿ƒä½¿åƒåœ¾å›æ”¶è¿›è¡Œçš„å…ƒå‡¶, ä¹Ÿå°±æ˜¯ç¨‹åºæœ¬èº«</p><p>ç†è§£ä¸ºæ”¶é›†å™¨çš„ä¼ å…¥çš„å˜é‡</p><p>åœ¨åƒåœ¾å›æ”¶çš„æ–‡çŒ®å½“ä¸­å°±æœ‰ä¸€ä¸ªæ¯”è¾ƒå¥‡æ€ªçš„æœ¯è¯­, <code>mutator</code>, ä¹Ÿç§°ä¸»ç¨‹åºå°±æ˜¯è¿™ä¸ª <code>mutator</code> çš„. èµ·å§‹å¯ä»¥ç†è§£ä¸º <code>mutator</code>
åªæ˜¯ä¸€ä¸ªå™ªéŸ³è€Œå·², äº¦å¯ç†è§£ä¸ºä¸è§„èŒƒç¼–å†™ä»£ç çš„ç¨‹åºå°±æ˜¯ä¸€ä¸ªä¸å¯ä¼°è®¡çš„å¼‚ç«¯.</p><hr><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="tri-color-collector">Tri-color Collector<a class="hash-link" href="#tri-color-collector" title="Direct link to heading">â€‹</a></h2><ul><li>Each object is in one of three states: white, gray, or black.</li><li>Non-visited objects are marked white.</li><li>Visited but not-traversed objects are marked gray.</li><li>Traversed objects are marked black.</li></ul><p><img loading="lazy" src="https://pic1.zhimg.com/v2-9a19f9bc005eb4561d827b7b385670e4_b.jpg" alt="å›¾ç‰‡" class="img_PFMr"></p><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="ä¸‰è‰²æ”¶é›†å™¨">ä¸‰è‰²æ”¶é›†å™¨<a class="hash-link" href="#ä¸‰è‰²æ”¶é›†å™¨" title="Direct link to heading">â€‹</a></h3><ul><li>æ¯ä¸ªç‰©ä½“éƒ½å¤„äºä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼šç™½è‰²ã€ç°è‰²æˆ–é»‘è‰².</li><li>æœªè®¿é—®çš„å¯¹è±¡è¢«æ ‡è®°ä¸ºç™½è‰².</li><li>å·²è®¿é—®ä½†æœªç»è¿‡çš„å¯¹è±¡æ ‡è®°ä¸ºç°è‰².</li><li>è¢«éå†çš„å¯¹è±¡è¢«æ ‡è®°ä¸ºé»‘è‰².</li></ul><hr><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="invariants">Invariants<a class="hash-link" href="#invariants" title="Direct link to heading">â€‹</a></h2><ul><li>Objects in the root set are gray or black.</li><li>A black object cannot point to a white object.</li><li>Gray objects define the boundary between the black objects and the white
objects.</li><li>Collection advances by traversing gray objects, turning them black.<ul><li>which may create new gray objects</li></ul></li><li>Collection ends when there are no more gray objects.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="å®šä¹‰ä¸å˜é‡">å®šä¹‰(ä¸å˜é‡)<a class="hash-link" href="#å®šä¹‰ä¸å˜é‡" title="Direct link to heading">â€‹</a></h3><ul><li><code>root set</code>ä¸­çš„å¯¹è±¡è¦ä¹ˆä¸ºç°è‰², è¦ä¹ˆä¸ºé»‘è‰².</li><li>é»‘è‰²çš„å¯¹è±¡ä¸ä¼šæŒ‡å‘ç™½è‰²å¯¹è±¡.</li><li>ç°è‰²å¯¹è±¡å®šä¹‰é»‘è‰²å¯¹è±¡å’Œç™½è‰²å¯¹è±¡ä¹‹é—´çš„è¾¹ç•Œ.</li><li>æ”¶é›†è¿‡ç¨‹é€šè¿‡ä¸æ–­åœ°éå†ç°è‰²å¯¹è±¡, å°†å…¶å˜ä¸ºé»‘è‰².<ul><li>è¿™å¯èƒ½ä¼šäº§ç”Ÿæ–°çš„ç°è‰²ç‰©ä½“</li></ul></li><li>å½“ä¸å†æœ‰ç°è‰²å¯¹è±¡æ—¶, æ”¶é›†æ­¥éª¤ç»“æŸ.</li></ul><p>åŒæ—¶ç°è‰²å­˜åœ¨çš„é‚£ä¸€åœˆè¢«ç†è§£ä¸ºä¸€ä¸ªè¾¹ç•Œ.</p><p>æœ€ç»ˆå°†ä¼šæ²¡æœ‰ç°è‰², é»‘è‰²å°†ä¼šè¢«ä¿ç•™, ç™½è‰²è¢«å½“ä½œåƒåœ¾ä½œä¸ºæ¸…é™¤.</p><hr><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="barriers">Barriers<a class="hash-link" href="#barriers" title="Direct link to heading">â€‹</a></h2><ul><li>The mutator can break the invariant of black objects not pointing to white
ones.
<code>t.x = {}</code></li><li>A <em>write barrier</em> tests this case and restores the invariant if necessary.<ul><li>slows down all assignments.</li></ul></li><li>It can either move forward the white object to gray or move backward the black
object to gray.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="å±éšœ">å±éšœ<a class="hash-link" href="#å±éšœ" title="Direct link to heading">â€‹</a></h3><ul><li><code>The mutator(ä¸ç¨³å®šå› ç´ )</code>å¯ä»¥æ‰“ç ´é»‘è‰²ç‰©ä½“ä¸æŒ‡å‘ç™½è‰²ç‰©ä½“çš„<code>invariant(å®šä¹‰)</code>.<ul><li>ä¾‹å¦‚è¿™ä¹ˆç¼–å†™çš„ä»£ç : <code>t.x = {}</code></li></ul></li><li>å†™å±éšœæ£€æµ‹åˆ°è¿™ç§æƒ…å†µæ—¶, å¹¶åœ¨å¿…è¦æ—¶ç¡®ä¿<code>invariant(å®šä¹‰)</code>ä¸ä¼šè¢«æ¨ç¿»(æ¢å¤ä¸å˜é‡).<ul><li>ä½†è¿™æ ·åšä½¿å¾—æ‰€æœ‰èµ‹å€¼æ“ä½œå˜æ…¢.</li></ul></li><li>å±éšœå°†ç™½è‰²å¯¹è±¡æ¨è¿›åˆ°ç°è‰², ä¹Ÿå¯ä»¥å°†é»‘è‰²å¯¹è±¡å›é€€åˆ°ç°è‰².</li></ul><p>ä¸Šé¢çš„ <code>t</code> ç†è§£ä¸ºé»‘è‰²å¯¹è±¡, <code>{}</code> ç†è§£ä¸ºä¸€ä¸ªæ–°çš„ç™½è‰²å¯¹è±¡, ç†è®ºä¸Šæ˜¯ä¸å­˜åœ¨, é»‘è‰²ç›´æ¥æŒ‡å‘ç™½è‰²çš„. æ‰€ä»¥è¿™é‡Œå°±æ‰“ç ´äº†å±éšœ.</p><hr><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="some-heuristics">Some Heuristics<a class="hash-link" href="#some-heuristics" title="Direct link to heading">â€‹</a></h2><ul><li>Objects moved back to gray are kept in a separate list to be traversed only in
the atomic phase.<ul><li>avoids a ping-pong</li></ul></li><li>Stacks are kept gray.<ul><li>avoids barriers when writing to the stack!</li></ul></li><li>Assignment to tables moves a black table back to gray.
<code>for i = 1, N do a[i] = &lt;exp&gt; end</code></li><li>Assignment of a metatable moves a white metatable forward to gray.
<code>setmetatable(obj, mt)</code></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="å¯å‘å¼å¤„ç†">å¯å‘å¼å¤„ç†<a class="hash-link" href="#å¯å‘å¼å¤„ç†" title="Direct link to heading">â€‹</a></h3><ul><li>ç§»å›çš„ç°è‰²å¯¹è±¡è¢«ä¿å­˜åœ¨ä¸€ä¸ªå•ç‹¬åˆ—è¡¨ä¸­, å¹¶åœ¨ä¹‹åçš„åŸå­é˜¶æ®µæ‰èƒ½éå†.<ul><li>é¿å…å¯¹è±¡çŠ¶æ€çš„åå¤å˜æ›´</li></ul></li><li>è®©æ ˆä¸­çš„å¯¹è±¡ä¿æŒç°è‰².<ul><li>é¿å…å†™å…¥æ ˆæ—¶å±éšœç”Ÿæ•ˆ.</li></ul></li><li>å¯¹è¡¨è¿›è¡Œèµ‹å€¼æ—¶å°†çŠ¶æ€ä¸ºé»‘è‰²çš„è¡¨å˜ä¸ºçŠ¶æ€ä¸ºç°è‰².
<code>for i = 1, N do a[i] = &lt;exp&gt; end</code></li><li>å¯¹å…ƒè¡¨è¿›è¡Œèµ‹å€¼æ—¶å°†çŠ¶æ€ä¸ºç™½è‰²çš„å…ƒè¡¨å˜ä¸ºçŠ¶æ€ä¸ºç°è‰².
<code>setmetatable(obj, mt)</code></li></ul><p>è¿™é‡Œçš„å†™å…¥æ ˆé€šå¸¸æ˜¯å†™å…¥å±€éƒ¨å˜é‡å‚æ•°, ä»£ä»·å°±æ˜¯åœ¨åŸå­é˜¶æ®µä¹Ÿéœ€è¦éå†æ ˆ.</p><hr><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="the-atomic-step">The Atomic Step<a class="hash-link" href="#the-atomic-step" title="Direct link to heading">â€‹</a></h2><ul><li>The mark phase is ended by an atomic step.</li><li>This step traverses all &quot;gray again&quot; objects.<ul><li>including stacks</li></ul></li><li>It clears weak tables.</li><li>It separates objects to be finalized, resurrecting them and their graphs.</li><li>It clears weak tables (again?).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="åŸå­é˜¶æ®µ">åŸå­é˜¶æ®µ<a class="hash-link" href="#åŸå­é˜¶æ®µ" title="Direct link to heading">â€‹</a></h3><ul><li>å¢é‡æ ‡è®°æ“ä½œç»“æŸåè¿›å…¥ä¸€ä¸ªåŸå­é˜¶æ®µ.</li><li>åŸå­é˜¶æ®µéå†æˆ‘ä»¬ä¹‹å‰ç»´æŠ¤åœ¨ä¸€ä¸ªç‹¬ç«‹çš„è¡¨ä¸­çš„æ‰€æœ‰&quot;å†æ¬¡å˜ä¸ºç°è‰²&quot;çš„å¯¹è±¡.<ul><li>åŒ…æ‹¬æ ˆä¸Šçš„å¯¹è±¡.</li></ul></li><li>æ¸…é™¤å¼±å¼•ç”¨çš„è¡¨.</li><li>åˆ†ç¦», å¹¶æ¢å¤éœ€è¦æ‰§è¡Œ<code>finalize</code>æ“ä½œçš„å¯¹è±¡.</li><li>å†æ¬¡æ¸…é™¤å¼±å¼•ç”¨çš„è¡¨.</li></ul><hr><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="the-incremental-collectors-pace">The Incremental Collector&#x27;s Pace<a class="hash-link" href="#the-incremental-collectors-pace" title="Direct link to heading">â€‹</a></h2><ul><li>An incremental collector runs alternated with the mutator.</li><li>At what pace?</li><li>Most collectors measure &quot;time&quot; by memory allocation.</li><li>How to translate bytes to GC activity?<ul><li>the fallacy of &quot;big userdata&quot;</li></ul></li><li>Two variables control the pace of the incremental collector.</li><li>The pause controls by how much memory has to grow before starting a new cycle.<ul><li>the fixed &quot;2&quot; in the old scheme.</li></ul></li><li>The multiplier controls the translation of bytes to GC work.<ul><li>still somewhat mystifying</li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="å¢é‡æ”¶é›†å™¨çš„èŠ‚å¥">å¢é‡æ”¶é›†å™¨çš„èŠ‚å¥<a class="hash-link" href="#å¢é‡æ”¶é›†å™¨çš„èŠ‚å¥" title="Direct link to heading">â€‹</a></h3><ul><li>å¢é‡æ”¶é›†å™¨ä¸<code>mutator(ä¸ç¨³å®šå› ç´ )</code>äº¤æ›¿è¿è¡Œ.</li><li>ä»¥æ€æ ·çš„èŠ‚å¥è¿›è¡Œå‘¢?</li><li>å¤§å¤šæ•°æ”¶é›†å™¨é€šè¿‡å†…å­˜åˆ†é…æ¥æŠŠæ¡&quot;æ—¶é—´&quot;.</li><li>æ‰€ä»¥æˆ‘ä»¬æ˜¯ä»¥å“ªç§æ–¹å¼æ¥å‘Šè¯‰æ”¶é›†å™¨éœ€è¦å¼€å§‹è¿è¡Œçš„å‘¢?<ul><li>é€šå¸¸å¤§å¤šæ•°äººç†è§£çš„<em>å¤§çš„ç”¨æˆ·æ•°æ®</em>, è¿™å…¶å®æ˜¯è°¬è®º.</li></ul></li><li>ä¸¤ä¸ªå˜é‡æ§åˆ¶å¢é‡æ”¶é›†å™¨çš„é€Ÿåº¦.</li><li><code>pause(æš‚åœ)</code>æ§åˆ¶ç€åœ¨å¼€å§‹ä¸€ä¸ªæ–°çš„å¾ªç¯ä¹‹å‰å¿…é¡»å¢åŠ å¤šå°‘å†…å­˜.<ul><li>æ—§æ–¹æ¡ˆä¸­çš„å›ºå®š&quot;2&quot;.</li></ul></li><li><code>multiplier(ä¹˜æ•°)</code>æ§åˆ¶åƒåœ¾å›æ”¶çš„å·¥ä½œé¢‘ç‡.<ul><li>è¿˜æ˜¯æœ‰ç‚¹ç¥ç§˜</li></ul></li></ul><p>æœ‰ä¸€ä¸ªç§°ä¸º<code>multiplier(ä¹˜æ•°)</code>çš„æ¨¡å‹, ç”¨ä»¥è°ƒæ•´å…¶é¢‘ç‡. å¦ä¸€ä¸ªæ˜¯<code>pause(æš‚åœ)</code>çš„æ¨¡å‹, å¯ä»¥è·å–æ›´å¤§çš„æš‚åœ.</p><hr><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="summary">Summary<a class="hash-link" href="#summary" title="Direct link to heading">â€‹</a></h2><p>An incremental collector reduces the length of pauses, but it does not reduce
the overall overhead of the collector; quite the opposite.</p><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="å°ç»“">å°ç»“<a class="hash-link" href="#å°ç»“" title="Direct link to heading">â€‹</a></h3><p>å¢é‡åƒåœ¾å›æ”¶è™½ç„¶å‡å°‘äº†ç¨‹åºæ¯æ¬¡æš‚åœçš„æ—¶é—´, ä½†åƒåœ¾å›æ”¶æ“ä½œçš„æ€»æ—¶é—´ä»£ä»·å’Œä¹‹å‰ç›¸æ¯”å¹¶æ²¡æœ‰å‡å°‘.</p><hr><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="the-generational-collector">The Generational Collector<a class="hash-link" href="#the-generational-collector" title="Direct link to heading">â€‹</a></h2><ul><li>The generational hypothesis: most objects die young.</li><li>So, the collector could concentrate its efforts in young objects.</li><li>All objects are classified as young or old. They are young when created; after
surviving two collections, they become old.</li><li>In a minor collection, the collector traverses and sweeps only young objects.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="åˆ†ä»£åƒåœ¾å›æ”¶å™¨">åˆ†ä»£åƒåœ¾å›æ”¶å™¨<a class="hash-link" href="#åˆ†ä»£åƒåœ¾å›æ”¶å™¨" title="Direct link to heading">â€‹</a></h3><ul><li>åˆ†ä»£å‡è®¾: å¤§å¤šæ•°å¯¹è±¡å¾ˆå¿«å¤±æ´».</li><li>å› æ­¤, æ”¶é›†å™¨å¯ä»¥æŠŠç²¾åŠ›é›†ä¸­åœ¨æ–°å¯¹è±¡ä¸Š.</li><li>æ‰€æœ‰å¯¹è±¡éƒ½åˆ†ä¸ºæ–°æ—§åˆ†ç±». ä»–ä»¬è¢«åˆ›é€ å‡ºæ¥æ—¶è¢«è®¤ä¸ºæ˜¯æ–°çš„ï¼›åœ¨ä¿å­˜äº†ä¸¤ä»£å, å¯¹è±¡å˜æ—§.</li><li>åœ¨<code>minor(å°)</code>é›†åˆä¸­, æ”¶é›†å™¨åªéå†å’Œæ¸…é™¤æ–°å¯¹è±¡.</li></ul><hr><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="the-generational-invariant">The Generational Invariant<a class="hash-link" href="#the-generational-invariant" title="Direct link to heading">â€‹</a></h2><ul><li>An old object should not point to a new one.</li><li>Not so easy to keep as the incremental invariant.</li><li>Both moving &quot;forward&quot; or &quot;backward&quot; have their problems.<ul><li>forward: creates too many old objects (and breaks invariant)</li><li>backward: breaks invariant somewhere else</li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="åˆ†ä»£çš„å®šä¹‰">åˆ†ä»£çš„å®šä¹‰<a class="hash-link" href="#åˆ†ä»£çš„å®šä¹‰" title="Direct link to heading">â€‹</a></h3><ul><li>æ—§å¯¹è±¡ä¸åº”æŒ‡å‘æ–°å¯¹è±¡.</li><li>ä¸åƒå¢é‡<code>invriant(å®šä¹‰)</code>é‚£ä¹ˆå®¹æ˜“ä¿æŒ.</li><li>&quot;æ¨è¿›&quot;æˆ–&quot;å›é€€&quot;éƒ½æœ‰é—®é¢˜.<ul><li>æ¨è¿›: åˆ›å»ºå¤ªå¤šçš„æ—§å¯¹è±¡ï¼ˆå¹¶ç ´å<code>invriant(å®šä¹‰)</code>ï¼‰</li><li>å›é€€: åŒæ ·ä¼šä¿®æ”¹å…¶<code>invriant(å®šä¹‰)</code></li></ul></li></ul><hr><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="the-touched-objects">The Touched Objects<a class="hash-link" href="#the-touched-objects" title="Direct link to heading">â€‹</a></h2><ul><li>If a back barrier detects an old object pointing to a new one, the old object
is marked as touched and put in a special list.<ul><li>not totally unlike the gray-again list</li></ul></li><li>Touched objects are also traversed (but not collected) in minor collections.</li><li>After two cycles, a touched object goes back to regular old, unless it is
touched again.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="è¢«è§¦æ‘¸çš„å¯¹è±¡">è¢«è§¦æ‘¸çš„å¯¹è±¡<a class="hash-link" href="#è¢«è§¦æ‘¸çš„å¯¹è±¡" title="Direct link to heading">â€‹</a></h3><ul><li>å¦‚æœå›é€€å±éšœæ£€æµ‹åˆ°æ—§å¯¹è±¡æŒ‡å‘äº†æ–°å¯¹è±¡, æ—§ç‰©ä½“å°†è¢«æ ‡è®°ä¸ºå·²è§¦æ‘¸, å¹¶æ”¾å…¥ç‰¹æ®Šåˆ—è¡¨ä¸­.<ul><li>å’Œ<code>(gray again)å†æ¬¡ç°è‰²åˆ—è¡¨</code>æ²¡ä»€ä¹ˆä¸¤æ ·</li></ul></li><li>è§¦æ‘¸çš„å¯¹è±¡ä¹Ÿä¼šåœ¨<code>minor(å°)</code>é›†åˆä¸­éå†ï¼ˆä½†ä¸ä¼šè¢«æ”¶é›†ï¼‰.</li><li>ç»è¿‡ä¸¤æ¬¡å¾ªç¯å, ä¸€ä¸ªè§¦æ‘¸çš„ç‰©ä½“ä¼šå›åˆ°åŸæ¥çš„çŠ¶æ€, é™¤éå®ƒå†æ¬¡è¢«è§¦æ‘¸.</li></ul><p><img loading="lazy" src="https://pic1.zhimg.com/v2-535211242d20aec0b7a3bbbbbc33e220_b.jpg" class="img_PFMr"></p><hr><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="questions">Questions<a class="hash-link" href="#questions" title="Direct link to heading">â€‹</a></h2><p>What was wrong with the generational collector in Lua 5.2?</p><p>Objects had to survive one GC cycle before becoming old.</p><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="æé—®">æé—®<a class="hash-link" href="#æé—®" title="Direct link to heading">â€‹</a></h3><ul><li><p>Lua 5.2çš„åˆ†ä»£åƒåœ¾å›æ”¶å™¨çš„é”™è¯¯ä¹‹å¤„æ˜¯ï¼Ÿ</p></li><li><p>æ–°å¯¹è±¡åªç»å†ä¸€æ¬¡åƒåœ¾å›æ”¶å°±å˜æ—§.</p></li></ul><hr><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="surviving-one-cycle">Surviving One Cycle<a class="hash-link" href="#surviving-one-cycle" title="Direct link to heading">â€‹</a></h2><ul><li>Much simpler implementation.</li><li>After a collection, all surviving objects become old, so the changes cannot
break the invariant.</li><li>List of touched objects can be erased.</li></ul><p><img loading="lazy" src="https://pic2.zhimg.com/v2-aac53cec9f897e7cd48d8cda0b2a56e5_b.jpg" class="img_PFMr"></p><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="å­˜æ´»ä¸€ä¸ªå‘¨æœŸ">å­˜æ´»ä¸€ä¸ªå‘¨æœŸ<a class="hash-link" href="#å­˜æ´»ä¸€ä¸ªå‘¨æœŸ" title="Direct link to heading">â€‹</a></h3><ul><li>å®ç°èµ·æ¥æ¯”è¾ƒç®€å•.</li><li>æ”¶é›†ä¹‹å, æ‰€æœ‰å¹¸å­˜çš„å¯¹è±¡éƒ½ä¼šå˜è€, å› æ­¤æ›´æ”¹ä¸ä¼šç ´å<code>invriant(å®šä¹‰)</code>.</li><li>è§¦æ‘¸å¯¹è±¡çš„åˆ—è¡¨å¯ä»¥åˆ é™¤.</li></ul><hr><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="surviving-two-cycles">Surviving Two Cycles<a class="hash-link" href="#surviving-two-cycles" title="Direct link to heading">â€‹</a></h2><ul><li>At the end of a collection, some new objects become old, some do not.<ul><li>breaks the invariant!</li></ul></li><li>List of touched objects must be corrected to next cycle.</li></ul><p><img loading="lazy" src="https://pic2.zhimg.com/v2-0eeb588f9817a55345e81beebdb1d5a9_b.jpg" class="img_PFMr"></p><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="å­˜æ´»ä¸¤ä¸ªå‘¨æœŸ">å­˜æ´»ä¸¤ä¸ªå‘¨æœŸ<a class="hash-link" href="#å­˜æ´»ä¸¤ä¸ªå‘¨æœŸ" title="Direct link to heading">â€‹</a></h3><ul><li>åœ¨ä¸€ä¸ªæ”¶é›†ä¹‹å, ä¸€äº›æ–°å¯¹è±¡å˜ä¸ºæ—§å¯¹è±¡, ä¸€äº›åˆ™ä¸å˜.<ul><li>æ‰“ç ´äº†<code>invriant(å®šä¹‰)</code></li></ul></li><li>è§¦æ‘¸å¯¹è±¡çš„åˆ—è¡¨å¿…é¡»æ›´æ­£åˆ°ä¸‹ä¸€ä¸ªå‘¨æœŸ.</li></ul><hr><h2 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="final-remarks">Final Remarks<a class="hash-link" href="#final-remarks" title="Direct link to heading">â€‹</a></h2><ul><li>When the generational hypothesis holds, a generational collector can reduce
the overhead of the GC.</li><li>Not always the hypothesis holds.<ul><li>batch programs</li></ul></li><li>Testing a collector is hard.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_c5FC" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h3><ul><li>å¦‚æœåˆ†ä»£çš„å‡è®¾æˆç«‹, åˆ†ä»£åƒåœ¾å›æ”¶å™¨å¯ä»¥å‡å°‘åƒåœ¾å›æ”¶çš„ä»£ä»·.</li><li>è¿™ä¸ªå‡è®¾å¹¶ä¸æ€»æ˜¯æˆç«‹çš„.<ul><li>ä»…ä»…æ˜¯å¯¹äºæ‰¹å¤„ç†è„šæœ¬æ¥è¯´å¾ˆå¤šæ—¶å€™è¿™ä¸ªå‡è®¾å°±ä¸æˆç«‹</li></ul></li><li>å¯¹äºåƒåœ¾å›æ”¶å™¨çš„å¥½åè¯„ä¼°è¾ƒä¸ºå›°éš¾.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/danyow/danyow.github.io/edit/main/docs/translation/luagc.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_OMbO" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vA0S"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-04-16T17:35:11.000Z">4/16/2022</time></b> by <b>danyow</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/en/docs/translation/boehm"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Boehmåƒåœ¾å›æ”¶</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_jWtb thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#automatic-memory-management" class="table-of-contents__link toc-highlight">Automatic Memory Management</a><ul><li><a href="#è‡ªåŠ¨å†…å­˜ç®¡ç†" class="table-of-contents__link toc-highlight">è‡ªåŠ¨å†…å­˜ç®¡ç†</a></li></ul></li><li><a href="#the-lua-gc" class="table-of-contents__link toc-highlight">The Lua GC</a><ul><li><a href="#luaçš„åƒåœ¾å›æ”¶" class="table-of-contents__link toc-highlight">Luaçš„åƒåœ¾å›æ”¶</a></li></ul></li><li><a href="#lua-gc-until-version-50" class="table-of-contents__link toc-highlight">Lua GC until Version 5.0</a><ul><li><a href="#lua-åœ¨-50-ä¹‹å‰çš„åƒåœ¾å›æ”¶" class="table-of-contents__link toc-highlight"><code>Lua</code> åœ¨ 5.0 ä¹‹å‰çš„åƒåœ¾å›æ”¶</a></li></ul></li><li><a href="#the-collectors-pace" class="table-of-contents__link toc-highlight">The Collector&#39;s Pace</a><ul><li><a href="#æ”¶é›†å™¨çš„èŠ‚å¥" class="table-of-contents__link toc-highlight">æ”¶é›†å™¨çš„èŠ‚å¥</a></li></ul></li><li><a href="#lua-gc-until-version-50defect" class="table-of-contents__link toc-highlight">Lua GC until Version 5.0(defect)</a><ul><li><a href="#lua-åœ¨-50-ä¹‹å‰çš„åƒåœ¾å›æ”¶ç¼ºç‚¹" class="table-of-contents__link toc-highlight"><code>Lua</code> åœ¨ 5.0 ä¹‹å‰çš„åƒåœ¾å›æ”¶(ç¼ºç‚¹)</a></li></ul></li><li><a href="#51" class="table-of-contents__link toc-highlight">5.1</a><ul><li><a href="#51-1" class="table-of-contents__link toc-highlight">5.1</a></li></ul></li><li><a href="#the-mutator" class="table-of-contents__link toc-highlight">The mutator</a><ul><li><a href="#the-mutatorä¸ç¨³å®šå› ç´ " class="table-of-contents__link toc-highlight">The mutator(ä¸ç¨³å®šå› ç´ )</a></li></ul></li><li><a href="#tri-color-collector" class="table-of-contents__link toc-highlight">Tri-color Collector</a><ul><li><a href="#ä¸‰è‰²æ”¶é›†å™¨" class="table-of-contents__link toc-highlight">ä¸‰è‰²æ”¶é›†å™¨</a></li></ul></li><li><a href="#invariants" class="table-of-contents__link toc-highlight">Invariants</a><ul><li><a href="#å®šä¹‰ä¸å˜é‡" class="table-of-contents__link toc-highlight">å®šä¹‰(ä¸å˜é‡)</a></li></ul></li><li><a href="#barriers" class="table-of-contents__link toc-highlight">Barriers</a><ul><li><a href="#å±éšœ" class="table-of-contents__link toc-highlight">å±éšœ</a></li></ul></li><li><a href="#some-heuristics" class="table-of-contents__link toc-highlight">Some Heuristics</a><ul><li><a href="#å¯å‘å¼å¤„ç†" class="table-of-contents__link toc-highlight">å¯å‘å¼å¤„ç†</a></li></ul></li><li><a href="#the-atomic-step" class="table-of-contents__link toc-highlight">The Atomic Step</a><ul><li><a href="#åŸå­é˜¶æ®µ" class="table-of-contents__link toc-highlight">åŸå­é˜¶æ®µ</a></li></ul></li><li><a href="#the-incremental-collectors-pace" class="table-of-contents__link toc-highlight">The Incremental Collector&#39;s Pace</a><ul><li><a href="#å¢é‡æ”¶é›†å™¨çš„èŠ‚å¥" class="table-of-contents__link toc-highlight">å¢é‡æ”¶é›†å™¨çš„èŠ‚å¥</a></li></ul></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a><ul><li><a href="#å°ç»“" class="table-of-contents__link toc-highlight">å°ç»“</a></li></ul></li><li><a href="#the-generational-collector" class="table-of-contents__link toc-highlight">The Generational Collector</a><ul><li><a href="#åˆ†ä»£åƒåœ¾å›æ”¶å™¨" class="table-of-contents__link toc-highlight">åˆ†ä»£åƒåœ¾å›æ”¶å™¨</a></li></ul></li><li><a href="#the-generational-invariant" class="table-of-contents__link toc-highlight">The Generational Invariant</a><ul><li><a href="#åˆ†ä»£çš„å®šä¹‰" class="table-of-contents__link toc-highlight">åˆ†ä»£çš„å®šä¹‰</a></li></ul></li><li><a href="#the-touched-objects" class="table-of-contents__link toc-highlight">The Touched Objects</a><ul><li><a href="#è¢«è§¦æ‘¸çš„å¯¹è±¡" class="table-of-contents__link toc-highlight">è¢«è§¦æ‘¸çš„å¯¹è±¡</a></li></ul></li><li><a href="#questions" class="table-of-contents__link toc-highlight">Questions</a><ul><li><a href="#æé—®" class="table-of-contents__link toc-highlight">æé—®</a></li></ul></li><li><a href="#surviving-one-cycle" class="table-of-contents__link toc-highlight">Surviving One Cycle</a><ul><li><a href="#å­˜æ´»ä¸€ä¸ªå‘¨æœŸ" class="table-of-contents__link toc-highlight">å­˜æ´»ä¸€ä¸ªå‘¨æœŸ</a></li></ul></li><li><a href="#surviving-two-cycles" class="table-of-contents__link toc-highlight">Surviving Two Cycles</a><ul><li><a href="#å­˜æ´»ä¸¤ä¸ªå‘¨æœŸ" class="table-of-contents__link toc-highlight">å­˜æ´»ä¸¤ä¸ªå‘¨æœŸ</a></li></ul></li><li><a href="#final-remarks" class="table-of-contents__link toc-highlight">Final Remarks</a><ul><li><a href="#æ€»ç»“" class="table-of-contents__link toc-highlight">æ€»ç»“</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/en/assets/js/runtime~main.ff5b954a.js"></script>
<script src="/en/assets/js/main.7d9fb09f.js"></script>
</body>
</html>